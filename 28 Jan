NCount (Selected Period) = 
VAR YearIsSel = HASONEVALUE('Calendar'[Year])
VAR MonthIsSel = HASONEVALUE('Calendar'[Month])

/* Pick a single target date based on slicers */
VAR TargetDate = 
    IF(
        MonthIsSel,
        CALCULATE(
            MAX('IT Architecture'[Date extracted]),  // Replace with your actual date column name
            ALLEXCEPT('Calendar', 'Calendar'[Year], 'Calendar'[Month])
        ),
        IF(
            YearIsSel,
            CALCULATE(
                MAX('IT Architecture'[Date extracted]),
                ALLEXCEPT('Calendar', 'Calendar'[Year])
            ),
            CALCULATE(
                MAX('IT Architecture'[Date extracted]),
                ALL('IT Architecture')
            )
        )
    )

RETURN
IF(
    ISBLANK(TargetDate),
    0,
    VAR SelectedYear = YEAR(TargetDate)
    VAR SelectedMonth = MONTH(TargetDate)
    
    /* Start date: First day of selected month */
    VAR CustomStartDate = DATE(SelectedYear, SelectedMonth, 1)
    
    /* End date: Last day of selected year */
    VAR EndDate = DATE(SelectedYear, 12, 31)
    
    VAR Result_ = 
        CALCULATE(
            COUNTROWS(
                FILTER(
                    'IT Architecture',
                    'IT Architecture'[Valid From] >= CustomStartDate 
                    && 'IT Architecture'[Valid From] <= EndDate
                    && YEAR('IT Architecture'[Valid From]) = SelectedYear  // Ensures Valid From is in selected year
                )
            )
        )
    
    RETURN COALESCE(Result_, 0)
)
