NCount (Latest - Keep OE) =
VAR YearIsSel  = HASONEVALUE ( 'Calendar'[Year] )
VAR MonthIsSel = HASONEVALUE ( 'Calendar'[MonthNo] )   -- must be 1..12

VAR SelYear  = SELECTEDVALUE ( 'Calendar'[Year] )
VAR SelMonth = SELECTEDVALUE ( 'Calendar'[MonthNo] )

/* Pick ONE snapshot date (latest) based on slicers */
VAR TargetExtractDate =
    SWITCH (
        TRUE (),
        MonthIsSel,
            CALCULATE (
                MAX ( 'IT Architecture'[Date extracted] ),
                ALLEXCEPT ( 'Calendar', 'Calendar'[Year], 'Calendar'[MonthNo] )
            ),
        YearIsSel,
            CALCULATE (
                MAX ( 'IT Architecture'[Date extracted] ),
                ALLEXCEPT ( 'Calendar', 'Calendar'[Year] )
            ),
        CALCULATE ( MAX ( 'IT Architecture'[Date extracted] ), ALL ( 'IT Architecture' ) )
    )

/* Date window */
VAR YearToUse =
    IF ( YearIsSel, SelYear, YEAR ( TargetExtractDate ) )

VAR StartDate =
    IF ( MonthIsSel, DATE ( YearToUse, SelMonth, 1 ), DATE ( YearToUse, 1, 1 ) )

VAR EndDate =
    DATE ( YearToUse, 12, 31 )

/* Out-of-range year check (only when user selects a year) */
VAR MinYear =
    CALCULATE ( MINX ( ALL ( 'IT Architecture' ), YEAR ( 'IT Architecture'[Date extracted] ) ) )
VAR MaxYear =
    CALCULATE ( MAXX ( ALL ( 'IT Architecture' ), YEAR ( 'IT Architecture'[Date extracted] ) ) )

RETURN
IF (
    ISBLANK ( TargetExtractDate )
        || ( YearIsSel && ( SelYear < MinYear || SelYear > MaxYear ) ),
    0,
    CALCULATE (
        COUNTROWS ( 'IT Architecture' ),

        /* ONLY lock to latest snapshot */
        KEEPFILTERS ( 'IT Architecture'[Date extracted] = TargetExtractDate ),

        /* IMPORTANT: do NOT use ALL('IT Architecture') here, or OE will break */
        FILTER (
            'IT Architecture',
            'IT Architecture'[Valid From] >= StartDate
                && 'IT Architecture'[Valid From] <= EndDate
        )
    ) + 0
)
